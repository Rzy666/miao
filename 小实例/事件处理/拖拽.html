<div class="dragable" style="width:100px;height:100px;left:0;top:0;background-color: cadetblue;">
  <span class="win-title">播放器窗口</span>
  <span class="win-resize"></span>
</div>
<div class="dragable" style="width:100px;height:100px;left:0;top:0;background-color: gold;">
  <span class="win-title">浏览器窗口</span>
  <span class="win-resize"></span>
</div>
<div class="dragable" style="width:100px;height:100px;left:0;top:0;background-color: aquamarine;">
  <span class="win-title">聊天</span>
  <span class="win-resize"></span>
  <span>aaa<strong>aa</strong>bbb</span>
</div>
<style>
  html{
    user-select: none;
  }
  .dragable {
    width: 100px;
    height: 100px;
    border: 2px solid;
    position: fixed;
  }
  .dragable .win-title{
    display: block;
    background-color: #0078d7;
    color: white;
    font-weight: bold;
    cursor: move;
  }
  .dragable .win-resize {
    position: absolute;
    width: 5px;
    height: 5px;
    bottom: 0;
    right: 0;
    margin-bottom: -2px;
    margin-right: -2px;
    cursor: nwse-resize;
    /* resize: both;
    overflow: auto; */
  }
</style>
<!-- <script>
  var startX,startY,nodeX,nodeY,nodeWidth,nodeHeight
  var state = ''
  var movingNode
  var resizingNode
  var maxZindex = 4
// document.addEventListener('mousedown' ,e => {
  //   var 标题栏 = e.target.closest('.win-title')
  //   startX = e.clientX
  //   startY = e.clientY
  //   if(标题栏){
  //     state = 'moving'
  //     movingNode = 标题栏.closest('.dragable')
  //     nodeX = parseInt(movingNode.style.left)
  //     nodeY = parseInt(movingNode.style.top)
  //     window.addEventListener('mousemove' , move)
  //   }
  //   if(e.target.matches('.win-resize')){
  //     state = 'resizing'
  //     resizingNode = e.target.closest('.dragable')
  //     nodeWidth = parseInt(resizingNode.style.width)
  //     nodeHeight = parseInt(resizingNode.style.height)
  //     window.addEventListener('mousemove' , move)
  //   }
  //   if(e.target.closest('.dragable')){
  //     e.target.closest('.dragable').style.zIndex = maxZindex++
  //   }
  // })
  // function move(e){
  //   if(e.which == 0){
  //     window.removeEventListener('mousemove' , move)
  //   } else {
  //     if(state == 'moving'){
  //       var dx = e.clientX - startX
  //       var dy = e.clientY - startY
  //       var left = nodeX + dx //位移的位置 = 鼠标点的位置+ moving移动的距离
  //       var top = nodeY + dy
  //       var 自动窗口 = 50
  //       if(left < 自动窗口){
  //         left = 0
  //       }
  //       if(top < 自动窗口){
  //         top = 0
  //       }
  //       if(left > innerWidth - movingNode.offsetWidth - 自动窗口){
  //         left = innerWidth - movingNode.offsetWidth
  //       }
  //       if(top > innerHeight - movingNode.offsetHeight - 自动窗口){
  //         top = innerHeight - movingNode.offsetHeight
  //       }
  //       movingNode.style.left = left + 'px'
  //       movingNode.style.top = top + 'px'
  //     }
  //     if(state == 'resizing'){
  //        var dx = e.clientX - startX
  //        var dy = e.clientY - startY
  //        resizingNode.style.width = nodeWidth + dx +'px'
  //        resizingNode.style.height = nodeHeight + dy + 'px'
  //     }
  //   }
  // }

document.addEventListener('mousedown' , e=> {
  var 标题栏 = e.target.closest('.win-title')
  startX = e.clientX
  startY = e.clientY
  if(标题栏){
    state = 'moving'
    movingNode = 标题栏.closest('.dragable')
    nodeX = parseInt(movingNode.style.left)
    nodeY = parseInt(movingNode.style.top)
    window.addEventListener('mousemove' , move)
  }
  if(e.target.matches('.win-resize')){
    state = 'resizing'
    resizingNode = e.target.closest('.dragable')
    nodeWidth = parseInt(resizingNode.style.width)
    nodeHeight = parseInt(resizingNode.style.height)
    window.addEventListener('mousemove' ,move)
  }
  if(e.target.closest('.dragable')){
    e.target.closest('.dragable').style.zIndex = maxZindex++
  }
  //  if(e.target.closest('.dragable')){
  //   e.target.closest('.dragable').style.zIndex = maxZindex++
  //   }
})
function move(e){
  if(e.which == 0){
    window.removeEventListener('mousemove' , move)
  } else {
    if(state == 'moving'){
      var dx = e.clientX - startX
      var dy = e.clientY -startY
      var left = nodeX + dx
      var top = nodeY + dy
      var 自动窗口 = 50
      if(left < 自动窗口){
        left = 0
      }
      if(top < 自动窗口){
        top = 0
      }
      if(left > innerWidth - movingNode.offsetWidth - 自动窗口){
        left = innerWidth - movingNode.offsetWidth
      }
      if(top > innerHeight - movingNode.offsetHeight -自动窗口){
        top = innerHeight - movingNode.offsetHeight
      }
      movingNode.style.left = left + 'px'
      movingNode.style.top = top + 'px'
    }
    if(state == 'resizing'){
      var dx = e.clientX - startX
      var dy = e.clientY -startY
      resizingNode.style.width = nodeWidth+dx + 'px'
      resizingNode.style.height = nodeHeight + dx + 'px'
    }
  }
}
</script> -->
<script>
  var startX,startY,nodeX,nodeY,nodeHeight,nodeWidth
  var state = ''
  var movingNode
  var resizingNode
  var maxZindex = 4
  document.addEventListener('mousedown',e=>{
    var 标题栏 = e.target.closest('.dragable')
    startX = e.clientX
    startY = e.clientY
    if(标题栏){
      state = 'moving'
      movingNode = 标题栏.closest('.dragable')
      nodeX = parseInt(movingNode.style.left)
      nodeY = parseInt(movingNode.style.top)
      window.addEventListener('mousemove' , move)
    }
    if(e.target.matches('.win-resize')){
      state = 'resizing'
      resizingNode = e.target.closest('.dragable')
      nodeWidth = parseInt(resizingNode.style.width)
      nodeHeight = parseInt(resizingNode.style.height)
      window.addEventListener('mousemove' , move)
    }
    if(e.target.closest('.dragable')){
      e.target.closest('.dragable').style.zIndex = maxZindex++
    }
  })
  function move(e){
    if(e.which == 0){
      window.removeEventListener('mousemove' ,move)
    } else {
      if(state == 'moving'){
        var dx = e.clientX - startX//移动的x位置
        var dy = e.clientY - startY//移动的y位置
        var left = nodeX +dx
        var top = nodeY +dy
        var 自动窗口 = 50
        if(left < 自动窗口){
          left = 0
        }
        if(top < 自动窗口){
          top = 0
        }
        if(left > innerWidth - movingNode.offsetWidth -自动窗口){
          left = innerWidth -movingNode.offsetwidth
        }
        if(top > innerHeight -movingNode.offsetHight - 自动窗口){
          top = innerHeight -movingNode.offsetHight
        }
        movingNode.style.left = left + 'px'
        movingNode.style.top =  top + 'px'
      }
      if(state == 'resizing'){
        var dx = e.clientX -startX
        var dy = e.clientY -startY
        resizingNode.style.width = nodeWidth + dx + 'px'
        resizingNode.style.height = nodeHeight +dy + 'px'
      }
    }
  }
</script>
